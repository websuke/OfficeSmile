# OfficeSmile

SpringBoot練習用で作成した帰社記録管理アプリです。

## 感想
この練習で作成したアプリの機能は大きくユーザー登録、帰社登録、帰宅登録の3機能のみです。

こんなミニアプリでも一人で一から作るとなると大変でした。

(全然やり残しあるので完成とは言えないですが。)

ただ、今回やってみて強く思ったのは分からなくても進んでみるのって結構勇気いりますがかなり大事ですね。

元々自分が分かってない所は理解できてるつもりでして、残念ながらそこは大方当たってましたが

分かってると思ってただけで実は分かってないという部分が想像以上に出てきました。

特にアーキテクチャ部分ですかね。

色々構成入れ替えを重ねて結果以下のような構成になるのかなーという考えにたどり着きましたが正直何か違う気がしてならないです。

MyBatisのMapperの設定が上手くいかなかったので下のような構成にちゃんと一致するようには出来てないですが。。。

```text:各レイヤー
// Presentation層
Controllerクラス
Formクラス

// Doamin層
UseCaseクラス(Scenarioクラスのほうがピンとくる気もする。)
Serviceクラス
Entityクラス

// Repository層
Daoクラス
DTOクラス
Mapperクラス
 ```

また、もう一つ上記と似た部分でかなり迷走した部分がもう一つあります。

それはFormやEntity、DTOなどの

データの詰替えタイミングやそれらが何と対応するほうが良いのかって部分です。

そこについては現状は以下の考えで進めてます。

(こちらも大したことやってないので完全一致はしておらず実コードではUseCaseとServiceは合体させてServiceを省略してます。)

```text:検索時の流れ
  画面入力
→ formに自動でバインドされてバックエンドにデータが入ってくる(なのでFormクラスは画面の項目に合わせる)
→ Controllerで受け取る
→ UseCaseのメソッド呼び出し(引数はUseCase主体で構える。)
→ UseCaseのメソッド内でServiceのメソッドを組み合わせて呼び出すことで、やりたいことを実現(UseCaseもServiceも@ServiceがつくことになるがServiceのメソッドにのみ@Cacheableなどつく？)
→ Daoのメソッド呼び出し(今回やってないがDomain層にDaoInterfaceを用意して依存関係を逆転させるほうが良いという理解)
→ DBから取得
→ DTOにマッピング(画面で必要な情報を持ったDTOを作成しておくと楽な気がするがRepository層→Domain層→Presentation層を全部横断するのってどうなん？)
→ 画面に返す
 ```

```text:登録・更新(削除含む)時の流れ
  画面入力
→ formに自動でバインドされてバックエンドにデータが入ってくる
→ entityに詰め替える(ここはまだPresentation層)※今回は考えがぶれてUseCaseで詰め替えしてる。。。
→ UseCaseのメソッド呼び出し
→ UseCaseのメソッド内でServiceのメソッドを組み合わせて呼び出すことで、やりたいことを実現(UseCaseもServiceも@ServiceがつくことになるがUseCaseのメソッドにのみ@Transactionalがつく)
→ Daoのメソッド呼び出し
→ DB登録・更新
(返却情報が必要なら返すが恐らくDTO作るまでもない？)
 ```

とまぁ、どこで詰替えを行うのがメリットが大きいかなども同様に自信はあまりなく、何なら考えがぶれてたりしてます。

後述の残作業対応の際に嫌でも既存のコードに修正が入る時が来ると思うので、

その際に上記の考えをブラッシュアップしていけたらと思います。

## 残(思いついたら追記予定)
1. 共通
   1. DBの値を見てバリデーションを実施できるようカスタムバリデーションの作成(対応したらTODOコメント削除する)
   2. メッセージプロパティ定義済みメッセージの改行をth:utextではなくth:textで可能にする
   3. 権限をEnumではなくテーブルで管理するように修正
   4. 操作ログとシステムログをちゃんと登録するようにする。(AOP)
   5. アーキテクチャがめちゃくちゃになった気がするのでクラス図に起こして、必要な箇所を修正する。
   6. Unitテストを実施する。
   7. アクセス修飾子を無差別publicにしてる部分も多いので見直し
   8. 変更が多そうな部分があればinterfaceもしくは委譲を使うようになってなければ修正
2. ユーザー
   1. 自分の帰社履歴が見れる画面の追加
3. 管理者・スーパーユーザー
   1. 各ユーザーの帰社履歴確認
   2. ユーザーCSV一括インポート機能
   3. ユーザーのパスワード変更
   4. ユーザー削除
   5. ユーザー帰社履歴一覧CSVエクスポート機能
   6. 帰社頻度少ない社員のお知らせ(頻度の基準は画面から設定可能にする)
   7. 役職の概念を取り込むだけで現在は利用してないため活用する